services:
  # -------------------------------------------------------------------------
  # VictoriaLogs: Log Backend (Prism's core observability)
  # -------------------------------------------------------------------------  
  victoria-logs:
    image: victoriametrics/victoria-logs:v1.43.1
    container_name: prism-victoria-logs
    restart: unless-stopped
    volumes:
      - vl-data:/victoria-logs-data
    command:
      - "--retentionPeriod=14d"
    healthcheck:
      test: [ "CMD", "wget", "-q", "--spider", "http://127.0.0.1:9428/health" ]
      start_period: 20s
    networks:
      - prism-net

  # -------------------------------------------------------------------------
  # Grafana: Visualization
  # -------------------------------------------------------------------------
  grafana:
    image: grafana/grafana:12.3
    container_name: prism-grafana
    depends_on:
      victoria-logs:
        condition: service_healthy
    ports:
      - "127.0.0.1:${GRAFANA_PORT:-3000}:3000"
    volumes:
      - grafana_data:/var/lib/grafana
    environment:
      - GF_PLUGINS_PREINSTALL=victoriametrics-logs-datasource
    networks:
      - prism-net

volumes:
  vl-data:
  grafana_data:
